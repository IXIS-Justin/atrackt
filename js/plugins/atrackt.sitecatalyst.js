// Generated by CoffeeScript 1.4.0

/*
Atrackt SiteCatalyst Plugin
https://github.com/brewster1134/atrackt
@author Ryan Brewster
@version 0.0.1
*/


(function() {

  window.Atrackt.registerPlugin('siteCatalyst', {
    send: function(obj) {
      var _ref;
      $.extend(obj, this.translatePropMap(obj));
      obj.categories = (_ref = obj.categories) != null ? _ref.join(this.options.delimiters.category) : void 0;
      if ((typeof s !== "undefined" && s !== null) && s.tl) {
        this.buildSObject(obj);
        return s.tl(true, 'o', this.buildLinkName(obj));
      } else {
        return console.log('SITE CATALYST SCRIPT NOT LOADED!', obj);
      }
    },
    options: {
      propLimit: 100,
      version: 14,
      delimiters: {
        linkName: '/',
        category: '|'
      },
      propMap: {
        plugin: 'plugin',
        location: 'prop1',
        categories: 'prop2',
        value: 'prop3',
        event: 'prop4'
      }
    },
    buildSObject: function(obj) {
      var eventsArray, i, varsArray, _i, _len, _ref;
      switch (this.options.version) {
        case 14:
          varsArray = ['products', 'events'];
          eventsArray = [];
          _ref = Array(this.options.propLimit);
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            i = _ref[_i];
            varsArray.push('prop' + (_i + 1));
            varsArray.push('eVar' + (_i + 1));
            eventsArray.push('event' + (_i + 1));
          }
          s.linkTrackVars = varsArray.join(',');
          s.linkTrackEvents = eventsArray.join(',');
          $.extend(s, obj);
          break;
        case 15:
          s.contextData = obj;
      }
      return s;
    },
    buildLinkName: function(obj) {
      var linkName;
      linkName = [];
      switch (this.options.version) {
        case 14:
          linkName = [obj.prop1, obj.prop2, obj.prop3];
          break;
        case 15:
          linkName = [obj.location, obj.categories, obj.value];
      }
      return linkName.join(this.options.delimiters.linkName);
    },
    translatePropMap: function(obj) {
      var _globalData,
        _this = this;
      if (this.options.version > 14) {
        return obj;
      }
      _globalData = {};
      $.each(obj, function(k, v) {
        return _globalData[_this.keyLookup(k)] = v;
      });
      return _globalData;
    },
    keyLookup: function(key) {
      var _newKey;
      _newKey = this.options.propMap[key];
      if (!_newKey) {
        console.log('NO MAPPING FOR "' + key + '" FOUND.');
      }
      return _newKey || key;
    }
  });

}).call(this);
